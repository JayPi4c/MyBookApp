<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<title>Book Management</title>
	<!-- Bootstrap CSS -->
	<link href="/webjars/bootstrap/dist/css/bootstrap.min.css" rel="stylesheet" type="text/css"/>
</head>
<body>

<div class="container my-5">
	<h1 class="mb-4 text-center">ðŸ“š Book Management</h1>

	<!-- Tabs navigation -->
	<ul class="nav nav-tabs" id="bookTab" role="tablist">
		<li class="nav-item" role="presentation">
			<button aria-controls="list" aria-selected="true" class="nav-link active" data-bs-target="#list" data-bs-toggle="tab"
					id="list-tab" role="tab" type="button">
				Available Books
			</button>
		</li>
		<li class="nav-item" role="presentation">
			<button aria-controls="add" aria-selected="false" class="nav-link" data-bs-target="#add" data-bs-toggle="tab" id="add-tab"
					role="tab" type="button">
				Add New Book
			</button>
		</li>
	</ul>

	<!-- Tab contents -->
	<div class="tab-content mt-4" id="bookTabContent">

		<!-- Books List Tab -->
		<div aria-labelledby="list-tab" class="tab-pane fade show active" id="list" role="tabpanel">
			<div class="text-center my-4" id="loading">
				<div class="spinner-border text-primary" role="status">
					<span class="visually-hidden">Loading...</span>
				</div>
			</div>

			<!-- Book list -->
			<div class="row row-cols-1 row-cols-md-2 row-cols-lg-3 g-4" id="book-container" style="display: none;">
				<!-- Cards will be inserted here by JS -->
			</div>

			<!-- Error message -->
			<div class="alert alert-danger text-center mt-4" id="error" style="display: none;">
				Failed to load books. Please try again later.
			</div>
		</div>

		<!-- Add Book Tab -->
		<div aria-labelledby="add-tab" class="tab-pane fade" id="add" role="tabpanel">
			<div class="card">
				<div class="card-body">
					<h5 class="card-title">Add a New Book</h5>
					<form id="add-book-form">
						<div class="mb-3">
							<label class="form-label" for="book-name">Book Name</label>
							<input class="form-control" id="book-name" required type="text">
						</div>
						<div class="mb-3">
							<label class="form-label" for="book-author">Author</label>
							<input class="form-control" id="book-author" required type="text">
						</div>
						<button class="btn btn-primary" type="submit">Add Book</button>
					</form>
				</div>
			</div>
			<div class="alert alert-success mt-3" id="add-success" style="display: none;">
				Book added successfully!
			</div>
		</div>
	</div>
</div>

<!-- Bootstrap JS (optional, for components like modals) -->
<script src="/webjars/bootstrap/dist/js/bootstrap.min.js"></script>

<!-- Custom JS -->
<script>
    const bookContainer = document.getElementById('book-container');
    const loadingSpinner = document.getElementById('loading');
    const errorBox = document.getElementById('error');
    const successBox = document.getElementById('add-success');

    function fetchBooks() {
        loadingSpinner.style.display = 'block';
        bookContainer.innerHTML = '';
        bookContainer.style.display = 'none';
        errorBox.style.display = 'none';

        fetch('/books')
            .then(resp => {
                if (!resp.ok) throw new Error("Failed to load");
                return resp.json();
            })
            .then(books => {
                loadingSpinner.style.display = 'none';
                bookContainer.style.display = 'flex';
                books.forEach(book => {
                    const card = document.createElement('div');
                    card.className = 'col';
                    card.innerHTML = `
                        <div class="card h-100 shadow-sm">
                            <div class="card-body">
                                <h5 class="card-title">${book.name}</h5>
                                <p class="card-text text-muted">by ${book.author}</p>
                            </div>
                        </div>
                    `;
                    bookContainer.appendChild(card);
                });
            })
            .catch(err => {
                console.error(err);
                loadingSpinner.style.display = 'none';
                errorBox.style.display = 'block';
            });
    }

    document.getElementById('add-book-form').addEventListener('submit', function (e) {
        e.preventDefault();
        const name = document.getElementById('book-name').value.trim();
        const author = document.getElementById('book-author').value.trim();

        fetch('/books', {
            method: 'POST',
            headers: {'Content-Type': 'application/json'},
            body: JSON.stringify({name, author})
        })
            .then(resp => {
                if (resp.status === 201) return resp.json();
                else throw new Error("Invalid input");
            })
            .then(newBook => {
                document.getElementById('book-name').value = '';
                document.getElementById('book-author').value = '';
                successBox.style.display = 'block';
                setTimeout(() => successBox.style.display = 'none', 2000);
                fetchBooks(); // Refresh the list
            })
            .catch(err => {
                console.error(err);
                alert("Failed to add book: " + err.message);
            });
    });

    // Fetch books when Available Books tab is shown
    document.getElementById('list-tab').addEventListener('shown.bs.tab', fetchBooks);

    // Initial load
    fetchBooks();
</script>
</body>
</html>